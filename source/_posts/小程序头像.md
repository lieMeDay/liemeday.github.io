---
title: 小程序canvas头像不显示
author: Born to the sun
top: false
cover: false
toc: false
mathjax: true
date: 2021-01-06 15:30:03
keywords:
summary: 小程序正式版 canvas画头像不显示
tags: [小程序,JavaScript]
categories: 小程序
---
小程序生成二维码分享，真机没问题，但正式版头像却出不来
微信有一部分从第三方引入的用户头像是 <font color=red>https://thirdwx.qlogo.cn</font>或<font color=red>https://wx.qlogo.cn</font> 开头的路径
canvas画头像需要先wx.getImageInfo获取下来，这个时候就可能会出现问题，那就是合法域名
![1](https://liemeday.github.io/blogPic/20210106153003/1.png)
这个时候只能去[微信公众平台](https://mp.weixin.qq.com/)去添加合法域名
具体：开发=》开发管理=》开发设置=》服务器域名 添加 https://wx.qlogo.cn
但是头像地址头可能是两种(MMP)
这个两种是通用的，应该是有ng转发配置，就是说他们可以互相调换
比如 https://wx.qlogo.cn/mmopen/vi_32/F6Cr8ib2GJtuFBSK64paqm6s11gz2AnpCcf6H5a7L3NsH6QgoiaEYGicIVglVxyYl5WaY6ceicxTIgcojydvfgyAZw/132
与 https://thirdwx.qlogo.cn/mmopen/vi_32/F6Cr8ib2GJtuFBSK64paqm6s11gz2AnpCcf6H5a7L3NsH6QgoiaEYGicIVglVxyYl5WaY6ceicxTIgcojydvfgyAZw/132
是相同的只是域名不同
我们后台服务器域名添加的为https://wx.qlogo.cn 那就可以进行替换
```javascript
wx.getImageInfo({
    // src: userInfo.headImgUrl, // 头像
    src: userInfo.headImgUrl.replace('https://thirdwx.qlogo.cn', 'https://wx.qlogo.cn'),
    success: function (res) {
     resolve(res);
    },
    fail: function (err) {
     resolve(err)
    },
})
```
解决思路，后台配置合法域名，通过 replace 方法将头像路径中的  <font color=red>https://thirdwx.qlogo.cn</font> 替换成 <font color=red>https://wx.qlogo.cn</font> ，头像还是原来的头像，但是可以下载成本地图片再也不会报错了，canvas 可以画头像了
啦啦啦 嘟嘟嘟 ~~~
